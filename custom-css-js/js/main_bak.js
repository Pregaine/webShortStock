
let inputData = [[]];
let chart;

function init() {

    let ori_update = document.getElementById('ori_chart');
    ori_update.addEventListener('click', doUpdate);

    let btn_update = document.getElementById('update_chart');
    btn_update.addEventListener('click', doUpdate);

}

function doUpdate() {

    if (!chart) {
        console.log('chart不存在，建立新的chart');
        chart = new Highcharts.stockChart('myKLinePic', {
            title: {
                text: 'AAPL stock price'
            },

            rangeSelector: {
                buttons: [

                {
                    type: 'all',
                    count: 1,
                    text: 'All'
                }

                ],

                selected: 1,
                inputEnabled: false
            },

            series: [{
                name: 'AAPL',
                type: 'candlestick',
                data: [[]],
                tooltip: {
                    valueDecimals: 2
                }
            }]
        });
    }

    console.log( 'chart,這個去做' );

    // let inputData = getAjaxData();

    getAjaxData();

    //chart.series[0].update({
    //     data: inputData
    //});

    console.log( 'do upDate chart.series' );

}


function getAjaxData(){

    // 這裡的return只是範例用，假設已經抓到資料
    let tmp = [
        [1317888000000,372.5101,375,372.2,372.52],
        [1317888060000,372.4,373,372.01,372.16],
        [1317888120000,372.16,372.4,371.39,371.62],
        [1317888180000,371.62,372.16,371.55,371.75],
        [1317888240000,371.75,372.4,371.57,372],
        [1317888300000,372,372.3,371.8,372.24],
        [1317888360000,372.22,372.45,372.22,372.3],
        [1317888420000,372.3,373.25,372.3,373.15],
        [1317888480000,373.01,373.5,373,373.24],
        [1317888540000,373.36,373.88,373.19,373.88],
        [1317888600000,373.8,374.34,373.75,374.29],
        [1317888660000,374.29,374.43,374,374.01],
        [1317888720000,374.05,374.35,373.76,374.35],
        [1317888780000,374.41,375.24,374.37,374.9],
        [1317888840000,374.83,375.73,374.81,374.96],
        [1317888900000,374.81,375.4,374.81,375.25],
        [1317888960000,375.2,375.7,375.14,375.19],
        [1317889020000,375.43,375.43,374.75,374.76],
        [1317889080000,374.94,375.5,374.81,375.13],
        [1317889140000,375.12,375.48,375,375.04],
        [1317889200000,375.24,375.24,375,375.08],
        [1317889260000,375.16,375.16,374.51,374.51],
        [1317889320000,374.51,374.75,374.2,374.27]
    ];

    tmp = [[1574006400000,308.5,315,307,309],[1573401600000,305,307.5,300,307],
           [1572796800000,302.5,311.5,301,305.5],[1572192000000,295,301.5,294,299],
           [1571587200000,291,294.5,288.5,293.5],[1570982400000,291.5,298,288.5,293],
           [1570377600000,279,286.5,277.5,282],[1569859200000,273,281,273,276.5],
           [1569168000000,264,272.5,262,272],[1568563200000,262,269.5,261.5,264],
           [1567958400000,265.5,266,260.5,262.5],[1567353600000,258,265,253,263.5],
           [1566748800000,249,259,248.5,259],[1566144000000,251.5,257.5,250.5,254],
           [1565539200000,254.5,254.5,246,250],[1564934400000,251,254,240,253.5],
           [1564329600000,260,263,250.5,251.5],[1563724800000,263,266.5,261,261],
           [1563120000000,251,261,249.5,259],[1562515200000,240,252,240,250.5],
           [1561910400000,245.5,250,241.5,243],[1561305600000,241,242,234,239],[1560700800000,231.5,248.5,230.5,248.5],
           [1560096000000,237.5,247.5,234.5,236],[1559491200000,235.5,238.5,229.5,232],[1558886400000,234,237.5,227,235.5],
           [1558281600000,242.5,243,230,233],[1557676800000,253,254,241.5,241.5],[1557072000000,260,263,255,256],
           [1556467200000,260,265,258,265],[1555862400000,266.5,270,257.5,260],[1555257600000,255,269.5,254,264.5],
           [1554652800000,251,254.5,250.5,252],[1554048000000,251,251,245,246.5],[1553443200000,240.5,245.5,240,245.5],
           [1552838400000,239.5,248.5,238,248.5],[1552233600000,228,239.5,227.5,239],[1551628800000,239.5,239.5,229,230],
           [1551024000000,237.5,240,236,239],[1550419200000,229,236.5,228.5,236.5],[1549814400000,228,232,226,227],
           [1548604800000,229.5,229.5,220,221],[1548000000000,220,227,219,226],[1547395200000,218.5,221,215.5,218.5],
           [1546790400000,212,220.5,210,220.5],[1546358400000,226.5,226.5,206.5,208],[1545580800000,221.5,225.5,215,225.5],
           [1544976000000,221,225.5,219,221.5],[1544371200000,219.5,227.5,218.5,222.5],[1543766400000,231,235,219.5,221],
           [1543161600000,219,231.5,218.5,225.5],[1542556800000,225,225,214,218.5],[1541952000000,230,234.5,224.5,226],
           [1541347200000,233,237.5,231,231],[1540742400000,223,237,220.5,236.5],[1540137600000,232.5,238,217,221],
           [1539532800000,234,243,229,236],[1538928000000,245.5,246.5,227,237],[1538323200000,262,264,248.5,250],[1537804800000,261.5,266,260,262.5],
           [1537113600000,262.5,262.5,254,261.5],[1536508800000,266.5,266.5,253.5,261],[1535904000000,259,268,255.5,264],
           [1535299200000,246,268,244.5,256],[1534694400000,239.5,246,238,243.5],[1534089600000,241.5,245,238,239.5],
           [1533484800000,245,248,241.5,245],[1532880000000,244.5,249.5,242,247],[1532275200000,239,245,238.5,244.5],[1531670400000,224.5,237.5,221,237.5],
           [1531065600000,219.5,224.5,218,224.5],[1530460800000,218.5,219,213,217],[1529856000000,220,220.5,210,216.5],
           [1529337600000,225.5,228,223.5,227.5],[1528646400000,226.5,232,224,231],[1528041600000,227.5,231.5,226,227],[1527436800000,229.5,230,220.5,224],
           [1526832000000,225,233.5,225,228.5],[1526227200000,234.5,234.5,223.5,223.5],[1525622400000,225,234,221.5,233],[1525017600000,224.5,228,220,223],
           [1524412800000,226.5,227.5,221,223.5],[1523808000000,243,244.5,228,229],[1523203200000,248,249,243.5,244.5],
           [1522598400000,248.5,249,242,244],[1521993600000,241.5,251,241.5,247.5],[1521388800000,252.5,255.5,244,245],[1520784000000,252,259,249.5,255],
           [1520179200000,242.5,251.5,240.5,250.5],[1519574400000,247,250.5,238.5,240],[1519142400000,244.5,245,239,245],[1518364800000,235.5,237.5,235,236.5],
           [1517760000000,251,254.5,228.5,232.5],[1517155200000,259,261.5,252,259.5],[1516550400000,257.5,266,253.5,255],[1515945600000,240,255.5,238,255.5],
           [1515340800000,242,242.5,232.5,237],[1514822400000,231.5,240,231,240],[1514131200000,228,230,225,229.5],[1513526400000,227,228.5,223.5,227.5]];

    // return tmp;

    let formData = new FormData(document.getElementById("form1"));
    let xhr = new XMLHttpRequest();

    xhr.open( 'POST', './custom-css-js/getResult.php', true );

    console.log( "xhr.onload" );

    xhr.onload = function(){

        if( xhr.status == 200){

            if(xhr.responseText == "error"){
                alert("Error");
            }
            else{

                console.log( xhr.responseText );
                console.log( 'test xhr.responseText' );

                var responseText = xhr.responseText;

                chart.series[0].update({
                    data: responseText
                });

                return;
            }
        }
        else{

            alert(xhr.status);
        }
    }

    xhr.send(formData);
}

window.addEventListener('load', init);
